<!DOCTYPE HTML>
<html lang="zh" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>1.2 系统调优 - linux笔记</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../1.基础/_index.html"><strong aria-hidden="true">1.</strong> 基础</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../1.基础/1.6 debian/_index.html"><strong aria-hidden="true">1.1.</strong> debian</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../1.基础/1.6 debian/1.6.1 sudo提权.html"><strong aria-hidden="true">1.1.1.</strong> 1.6.1 sudo提权</a></li></ol></li><li class="chapter-item expanded "><a href="../1.基础/1.7 ubuntu/_index.html"><strong aria-hidden="true">1.2.</strong> ubuntu</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../1.基础/1.7 ubuntu/ubuntu 开机启动.html"><strong aria-hidden="true">1.2.1.</strong> ubuntu 开机启动</a></li><li class="chapter-item expanded "><a href="../1.基础/1.7 ubuntu/ubuntu 收藏夹 快捷方式.html"><strong aria-hidden="true">1.2.2.</strong> ubuntu 收藏夹 快捷方式</a></li></ol></li><li class="chapter-item expanded "><a href="../1.基础/1.1 目录结构.html"><strong aria-hidden="true">1.3.</strong> 1.1 目录结构</a></li><li class="chapter-item expanded "><a href="../1.基础/1.2 系统调优.html" class="active"><strong aria-hidden="true">1.4.</strong> 1.2 系统调优</a></li><li class="chapter-item expanded "><a href="../1.基础/1.2.1 修改系统参数.html"><strong aria-hidden="true">1.5.</strong> 1.2.1 修改系统参数</a></li><li class="chapter-item expanded "><a href="../1.基础/1.3 自动化.html"><strong aria-hidden="true">1.6.</strong> 1.3 自动化</a></li><li class="chapter-item expanded "><a href="../1.基础/1.4 系统设置.html"><strong aria-hidden="true">1.7.</strong> 1.4 系统设置</a></li><li class="chapter-item expanded "><a href="../1.基础/1.5 常用命令.html"><strong aria-hidden="true">1.8.</strong> 1.5 常用命令</a></li><li class="chapter-item expanded "><a href="../1.基础/1.5.1 man.html"><strong aria-hidden="true">1.9.</strong> 1.5.1 man</a></li><li class="chapter-item expanded "><a href="../1.基础/1.5.2 用户及文件权限管理.html"><strong aria-hidden="true">1.10.</strong> 1.5.2 用户及文件权限管理</a></li><li class="chapter-item expanded "><a href="../1.基础/1.5.3 包管理.html"><strong aria-hidden="true">1.11.</strong> 1.5.3 包管理</a></li><li class="chapter-item expanded "><a href="../1.基础/1.5.4 性能监控工具.html"><strong aria-hidden="true">1.12.</strong> 1.5.4 性能监控工具</a></li></ol></li><li class="chapter-item expanded "><a href="../2.Shell 教程/_index.html"><strong aria-hidden="true">2.</strong> Shell 教程</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../2.Shell 教程/2.1. 基础教程/_index.html"><strong aria-hidden="true">2.1.</strong> 基础教程</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../2.Shell 教程/2.1. 基础教程/2.1.1 终端快捷键.html"><strong aria-hidden="true">2.1.1.</strong> 2.1.1 终端快捷键</a></li><li class="chapter-item expanded "><a href="../2.Shell 教程/2.1. 基础教程/2.1.2 通配符.html"><strong aria-hidden="true">2.1.2.</strong> 2.1.2 通配符</a></li><li class="chapter-item expanded "><a href="../2.Shell 教程/2.1. 基础教程/2.1.3 关键字.html"><strong aria-hidden="true">2.1.3.</strong> 2.1.3 关键字</a></li><li class="chapter-item expanded "><a href="../2.Shell 教程/2.1. 基础教程/2.1.4 语法.html"><strong aria-hidden="true">2.1.4.</strong> 2.1.4 语法</a></li><li class="chapter-item expanded "><a href="../2.Shell 教程/2.1. 基础教程/2.1.5 Function.html"><strong aria-hidden="true">2.1.5.</strong> 2.1.5 Function</a></li><li class="chapter-item expanded "><a href="../2.Shell 教程/2.1. 基础教程/2.1.6 转译符.html"><strong aria-hidden="true">2.1.6.</strong> 2.1.6 转译符</a></li><li class="chapter-item expanded "><a href="../2.Shell 教程/2.1. 基础教程/2.1.7 数据结构.html"><strong aria-hidden="true">2.1.7.</strong> 2.1.7 数据结构</a></li><li class="chapter-item expanded "><a href="../2.Shell 教程/2.2. Shell脚本/shtools/index.html"><strong aria-hidden="true">2.1.8.</strong> Shtools</a></li></ol></li><li class="chapter-item expanded "><a href="../2.Shell 教程/2.2. Shell脚本/_index.html"><strong aria-hidden="true">2.2.</strong> Shell脚本</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../2.Shell 教程/2.2. Shell脚本/安装系统后操作.html"><strong aria-hidden="true">2.2.1.</strong> 安装系统后操作</a></li></ol></li><li class="chapter-item expanded "><a href="../2.Shell 教程/2.3. Makefile/_index.html"><strong aria-hidden="true">2.3.</strong> Makefile</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../2.Shell 教程/2.3. Makefile/2.3.1 案例Makefile 1.html"><strong aria-hidden="true">2.3.1.</strong> 2.3.1 案例Makefile 1</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../3.Linux 命令/_index.html"><strong aria-hidden="true">3.</strong> Linux 命令</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../3.Linux 命令/1.文件管理/_index.html"><strong aria-hidden="true">3.1.</strong> 文件管理</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../3.Linux 命令/1.文件管理/1.1 文件管理.html"><strong aria-hidden="true">3.1.1.</strong> 1.1 文件管理</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/1.文件管理/1.2 目录.html"><strong aria-hidden="true">3.1.2.</strong> 1.2 目录</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/1.文件管理/1.3 权限.html"><strong aria-hidden="true">3.1.3.</strong> 1.3 权限</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/1.文件管理/1.4 压缩.html"><strong aria-hidden="true">3.1.4.</strong> 1.4 压缩</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/1.文件管理/1.4.1 zip.html"><strong aria-hidden="true">3.1.5.</strong> 1.4.1 zip</a></li></ol></li><li class="chapter-item expanded "><a href="../3.Linux 命令/2.文档编辑/_index.html"><strong aria-hidden="true">3.2.</strong> 文档编辑</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../3.Linux 命令/2.文档编辑/2.1 文档编辑.html"><strong aria-hidden="true">3.2.1.</strong> 2.1 文档编辑</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/2.文档编辑/2.10 wc.html"><strong aria-hidden="true">3.2.2.</strong> 2.10 wc</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/2.文档编辑/2.2 sed.html"><strong aria-hidden="true">3.2.3.</strong> 2.2 sed</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/2.文档编辑/2.3 awk.html"><strong aria-hidden="true">3.2.4.</strong> 2.3 awk</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/2.文档编辑/2.4 uniq.html"><strong aria-hidden="true">3.2.5.</strong> 2.4 uniq</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/2.文档编辑/2.5 sort.html"><strong aria-hidden="true">3.2.6.</strong> 2.5 sort</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/2.文档编辑/2.6 grep.html"><strong aria-hidden="true">3.2.7.</strong> 2.6 grep</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/2.文档编辑/2.7 tail.html"><strong aria-hidden="true">3.2.8.</strong> 2.7 tail</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/2.文档编辑/2.8 find.html"><strong aria-hidden="true">3.2.9.</strong> 2.8 find</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/2.文档编辑/2.9 iconv.html"><strong aria-hidden="true">3.2.10.</strong> 2.9 iconv</a></li></ol></li><li class="chapter-item expanded "><a href="../3.Linux 命令/3.系统管理/_index.html"><strong aria-hidden="true">3.3.</strong> 系统管理</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../3.Linux 命令/3.系统管理/3.1 crontab.html"><strong aria-hidden="true">3.3.1.</strong> 3.1 crontab</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/3.系统管理/3.2 nohup.html"><strong aria-hidden="true">3.3.2.</strong> 3.2 nohup</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/3.系统管理/3.3 xclip.html"><strong aria-hidden="true">3.3.3.</strong> 3.3 xclip</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/3.系统管理/3.4 tmux.html"><strong aria-hidden="true">3.3.4.</strong> 3.4 tmux</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/3.系统管理/3.5 systemd.html"><strong aria-hidden="true">3.3.5.</strong> 3.5 systemd</a></li></ol></li><li class="chapter-item expanded "><a href="../3.Linux 命令/4.磁盘管理/_index.html"><strong aria-hidden="true">3.4.</strong> 磁盘管理</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../3.Linux 命令/4.磁盘管理/4.1 du.html"><strong aria-hidden="true">3.4.1.</strong> 4.1 du</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/4.磁盘管理/4.2 mount.html"><strong aria-hidden="true">3.4.2.</strong> 4.2 mount</a></li></ol></li><li class="chapter-item expanded "><a href="../3.Linux 命令/5.文件传输/_index.html"><strong aria-hidden="true">3.5.</strong> 文件传输</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/6.网络通讯/_index.html"><strong aria-hidden="true">3.6.</strong> 网络通讯</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../3.Linux 命令/6.网络通讯/6.1 tcpdump.html"><strong aria-hidden="true">3.6.1.</strong> 6.1 tcpdump</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/6.网络通讯/6.2 curl.html"><strong aria-hidden="true">3.6.2.</strong> 6.2 curl</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/6.网络通讯/6.3 ssh.html"><strong aria-hidden="true">3.6.3.</strong> 6.3 ssh</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/6.网络通讯/6.4 tc.html"><strong aria-hidden="true">3.6.4.</strong> 6.4 tc</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/6.网络通讯/6.5 firewall.html"><strong aria-hidden="true">3.6.5.</strong> 6.5 firewall</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/6.网络通讯/6.6 openssh.html"><strong aria-hidden="true">3.6.6.</strong> 6.6 openssh</a></li><li class="chapter-item expanded "><a href="../3.Linux 命令/6.网络通讯/nc.html"><strong aria-hidden="true">3.6.7.</strong> Nc</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../4.Linux软件/_index.html"><strong aria-hidden="true">4.</strong> Linux软件</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../4.Linux软件/4.1 idea/_index.html"><strong aria-hidden="true">4.1.</strong> idea</a></li><li class="chapter-item expanded "><a href="../4.Linux软件/4.2 vim/_index.html"><strong aria-hidden="true">4.2.</strong> vim</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../4.Linux软件/4.2 vim/VIM.html"><strong aria-hidden="true">4.2.1.</strong> VIM</a></li></ol></li><li class="chapter-item expanded "><a href="../4.Linux软件/4.3 Let's Encrypt/_index.html"><strong aria-hidden="true">4.3.</strong> Let's Encrypt</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../4.Linux软件/4.3 Let's Encrypt/4.3.1 acme.html"><strong aria-hidden="true">4.3.1.</strong> 4.3.1 acme</a></li></ol></li><li class="chapter-item expanded "><a href="../4.Linux软件/4.4 nginx/_index.html"><strong aria-hidden="true">4.4.</strong> nginx</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../4.Linux软件/4.4 nginx/4.4.1nginxError排查.html"><strong aria-hidden="true">4.4.1.</strong> 4.4.1nginxError排查</a></li><li class="chapter-item expanded "><a href="../4.Linux软件/4.4 nginx/4.4.2nginxRewrite规则.html"><strong aria-hidden="true">4.4.2.</strong> 4.4.2nginxRewrite规则</a></li><li class="chapter-item expanded "><a href="../4.Linux软件/4.4 nginx/4.4.3nginx_grpc_conf.html"><strong aria-hidden="true">4.4.3.</strong> 4.4.3nginx_grpc_conf</a></li><li class="chapter-item expanded "><a href="../4.Linux软件/4.4 nginx/4.4.4nginx_conf.html"><strong aria-hidden="true">4.4.4.</strong> 4.4.4nginx_conf</a></li><li class="chapter-item expanded "><a href="../4.Linux软件/4.4 nginx/4.4.5nginx安装.html"><strong aria-hidden="true">4.4.5.</strong> 4.4.5nginx安装</a></li></ol></li><li class="chapter-item expanded "><a href="../4.Linux软件/4.5 v2ray/_index.html"><strong aria-hidden="true">4.5.</strong> v2ray</a></li><li class="chapter-item expanded "><a href="../4.Linux软件/4.6 Docker/_index.html"><strong aria-hidden="true">4.6.</strong> Docker</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../4.Linux软件/4.6 Docker/4.6.1 Docker-Dockerfile.html"><strong aria-hidden="true">4.6.1.</strong> 4.6.1 Docker-Dockerfile</a></li><li class="chapter-item expanded "><a href="../4.Linux软件/4.6 Docker/4.6.2 Docker.html"><strong aria-hidden="true">4.6.2.</strong> 4.6.2 Docker</a></li><li class="chapter-item expanded "><a href="../4.Linux软件/4.6 Docker/4.6.4 Docker Compose.html"><strong aria-hidden="true">4.6.3.</strong> 4.6.4 Docker Compose</a></li><li class="chapter-item expanded "><a href="../4.Linux软件/4.6 Docker/4.6.5 Docker-网络.html"><strong aria-hidden="true">4.6.4.</strong> 4.6.5 Docker-网络</a></li></ol></li><li class="chapter-item expanded "><a href="../4.Linux软件/4.7 git/_index.html"><strong aria-hidden="true">4.7.</strong> git</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../4.Linux软件/4.7 git/git.html"><strong aria-hidden="true">4.7.1.</strong> Git</a></li><li class="chapter-item expanded "><a href="../4.Linux软件/4.7 git/gitea.html"><strong aria-hidden="true">4.7.2.</strong> Gitea</a></li></ol></li><li class="chapter-item expanded "><a href="../4.Linux软件/4.3.4 frp.html"><strong aria-hidden="true">4.8.</strong> 4.3.4 frp</a></li><li class="chapter-item expanded "><a href="../4.Linux软件/4.3.5 protobuf.html"><strong aria-hidden="true">4.9.</strong> 4.3.5 protobuf</a></li><li class="chapter-item expanded "><a href="../4.Linux软件/4.3.6 wget.html"><strong aria-hidden="true">4.10.</strong> 4.3.6 wget</a></li><li class="chapter-item expanded "><a href="../4.Linux软件/4.4.4 svn.html"><strong aria-hidden="true">4.11.</strong> 4.4.4 svn</a></li><li class="chapter-item expanded "><a href="../4.Linux软件/ntp.html"><strong aria-hidden="true">4.12.</strong> Ntp</a></li></ol></li><li class="chapter-item expanded "><a href="../etc_/index.html"><strong aria-hidden="true">5.</strong> Etc</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../etc_/cpp/project_tpl/index.html"><strong aria-hidden="true">5.1.</strong> Project Tpl</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">linux笔记</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/yujian1018/yujian1018.github.io/tree/master/linux" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/yujian1018/yujian1018.github.io/edit/master/linux/content/1.基础/1.2 系统调优.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="系统调优"><a class="header" href="#系统调优">系统调优</a></h2>
<pre><code class="language-bash">ulimit -a

ulimit -n 102400
1.在/etc/rc.local 中增加一行 ulimit -SHn 65535
2.在/etc/profile 中增加一行 ulimit -SHn 65535
3.在/etc/security/limits.conf最后增加如下两行记录
* soft nofile 65535
* hard nofile 65535

查看 /etc/security/limits.conf 没有就新建，加入 core 和 nofile 的相关配置，比如：
* soft nofile 65536
* hard nofile 65536
* soft core unlimited
* hard core unlimited
# End of file
之类的，不用到 ~/.bashrc 里面调用 ulimit。


sudo vim /etc/sysctl.conf
fs.inotify.max_user_watches=16384

ulimit -n 8192

</code></pre>
<div class="table-wrapper"><table><thead><tr><th style="text-align: left">type</th><th style="text-align: left">cmd</th><th style="text-align: left">说明</th></tr></thead><tbody>
<tr><td style="text-align: left">core file size</td><td style="text-align: left">(blocks, -c) 0</td><td style="text-align: left"></td></tr>
<tr><td style="text-align: left">data seg size</td><td style="text-align: left">(kbytes, -d) unlimited</td><td style="text-align: left">数据段长度</td></tr>
<tr><td style="text-align: left">scheduling priority</td><td style="text-align: left">(-e) 0</td><td style="text-align: left"></td></tr>
<tr><td style="text-align: left">file size</td><td style="text-align: left">(blocks, -f) unlimited</td><td style="text-align: left">文件大小</td></tr>
<tr><td style="text-align: left">pending</td><td style="text-align: left">signals (-i) 15240</td><td style="text-align: left"></td></tr>
<tr><td style="text-align: left">max locked memory</td><td style="text-align: left">(kbytes, -l) 64</td><td style="text-align: left"></td></tr>
<tr><td style="text-align: left">max memory size</td><td style="text-align: left">(kbytes, -m) unlimited</td><td style="text-align: left">最大内存大小</td></tr>
<tr><td style="text-align: left">open files</td><td style="text-align: left">(-n) 1024</td><td style="text-align: left">可打开的文件数</td></tr>
<tr><td style="text-align: left">pipe size</td><td style="text-align: left">(512 bytes, -p) 8</td><td style="text-align: left"></td></tr>
<tr><td style="text-align: left">POSIX message queues</td><td style="text-align: left">(bytes, -q) 819200</td><td style="text-align: left"></td></tr>
<tr><td style="text-align: left">real-time priority</td><td style="text-align: left">(-r) 0</td><td style="text-align: left"></td></tr>
<tr><td style="text-align: left">stack size</td><td style="text-align: left">(kbytes, -s) 8192</td><td style="text-align: left">堆栈大小</td></tr>
<tr><td style="text-align: left">cpu time</td><td style="text-align: left">(seconds, -t) unlimited CPU</td><td style="text-align: left">时间</td></tr>
<tr><td style="text-align: left">max user processes</td><td style="text-align: left">(-u) 15240</td><td style="text-align: left">最大进程数</td></tr>
<tr><td style="text-align: left">virtual memory</td><td style="text-align: left">(kbytes, -v) unlimited</td><td style="text-align: left">虚拟内存</td></tr>
<tr><td style="text-align: left">file locks</td><td style="text-align: left">(-x) unlimited</td><td style="text-align: left"></td></tr>
</tbody></table>
</div>
<h2 id="网卡多队列"><a class="header" href="#网卡多队列">网卡多队列</a></h2>
<pre><code class="language-bash">打开内核网卡多队列支持，避免网卡中断都集中在 cpu0 上处理，多队列打开后，可以让网卡中断均摊到各个 cpu上，对提高并发十分有用：

wget http://skywind3000.github.io/install/set_irq_affinity.sh

放到 /etc/config 目录下面（没有就新建），然后在 /etc/rc.local 里面加一行，每次重启就跑 set_irq_affinity.sh 且必须用 bash跑，参数传入需要开启多队列的网卡，以下是 /etc/rc.local 的内容：
/bin/bash 
/etc/set_irq_affinity.sh eth0 eth1 eth2
 
exit 0
下面是 setirqaffinity.sh 的代码：
# setting up irq affinity according to /proc/interrupts
# 2008-11-25 Robert Olsson
# 2009-02-19 updated by Jesse Brandeburg
#
# &gt; Dave Miller:
# (To get consistent naming in /proc/interrups)
# I would suggest that people use something like:
#   char buf[IFNAMSIZ+6];
#
#   sprintf(buf, &quot;%s-%s-%d&quot;,
#           netdev-&gt;name,
#       (RX_INTERRUPT ? &quot;rx&quot; : &quot;tx&quot;),
#       queue-&gt;index);
#
#  Assuming a device with two RX and TX queues.
#  This script will assign: 
#
#   eth0-rx-0  CPU0
#   eth0-rx-1  CPU1
#   eth0-tx-0  CPU0
#   eth0-tx-1  CPU1
#
 
set_affinity()
{
    MASK=$((1&lt;&lt;$VEC))
    printf &quot;%s mask=%X for /proc/irq/%d/smp_affinity\n&quot; $DEV $MASK $IRQ
    printf &quot;%X&quot; $MASK &gt; /proc/irq/$IRQ/smp_affinity
    #echo $DEV mask=$MASK for /proc/irq/$IRQ/smp_affinity
    #echo $MASK &gt; /proc/irq/$IRQ/smp_affinity
}
 
if [ &quot;$1&quot; = &quot;&quot; ] ; then
    echo &quot;Description:&quot;
    echo &quot;    This script attempts to bind each queue of a multi-queue NIC&quot;
    echo &quot;    to the same numbered core, ie tx0|rx0 --&gt; cpu0, tx1|rx1 --&gt; cpu1&quot;
    echo &quot;usage:&quot;
    echo &quot;    $0 eth0 [eth1 eth2 eth3]&quot;
fi
 
 
# check for irqbalance running
IRQBALANCE_ON=`ps ax | grep -v grep | grep -q irqbalance; echo $?`
if [ &quot;$IRQBALANCE_ON&quot; == &quot;0&quot; ] ; then
    echo &quot; WARNING: irqbalance is running and will&quot;
    echo &quot;          likely override this script's affinitization.&quot;
    echo &quot;          Please stop the irqbalance service and/or execute&quot;
    echo &quot;          'killall irqbalance'&quot;
fi
 
#
# Set up the desired devices.
#
 
for DEV in $*
do
  for DIR in rx tx TxRx
  do
     MAX=`grep $DEV-$DIR /proc/interrupts | wc -l`
     if [ &quot;$MAX&quot; == &quot;0&quot; ] ; then
       MAX=`egrep -i &quot;$DEV:.*$DIR&quot; /proc/interrupts | wc -l`
     fi
     if [ &quot;$MAX&quot; == &quot;0&quot; ] ; then
       echo no $DIR vectors found on $DEV
       continue
       #exit 1
     fi
     for VEC in `seq 0 1 $MAX`
     do
        IRQ=`cat /proc/interrupts | grep -i $DEV-$DIR-$VEC&quot;$&quot;  | cut  -d:  -f1 | sed &quot;s/ //g&quot;`
        if [ -n  &quot;$IRQ&quot; ]; then
          set_affinity
        else
           IRQ=`cat /proc/interrupts | egrep -i $DEV:v$VEC-$DIR&quot;$&quot;  | cut  -d:  -f1 | sed &quot;s/ //g&quot;`
           if [ -n  &quot;$IRQ&quot; ]; then
             set_affinity
           fi
        fi
     done
  done
done
 
 
# done
重启以后，cat 一下 /proc/interrupts里面，最右边网卡相关的中断是不是分摊到不同的cpu上面了。
</code></pre>
<h2 id="网络参数优化"><a class="header" href="#网络参数优化">网络参数优化</a></h2>
<pre><code class="language-bash">参考下面 /etc/sysctl.conf里面的优化选项和你 /etc/sysctl.conf 的具体内容，视情况更改：

#

# /etc/sysctl.conf - Configuration file for setting system variables

fs.file-max = 100000

# 表示开启SYN Cookies。当出现SYN等待队列溢出时，启用cookies来处理，可防范少量SYN攻击，默认为0

# 是为了防止一定程度上的DOD的

net.ipv4.tcp_syncookies = 1

# 表示开启重用。允许将TIME-WAIT sockets重新用于新的TCP连接，默认为0，表示关闭； 不是很建议设置，可能接受错误的数据

# net.ipv4.tcp_tw_reuse = 1

# 表示尽量不启用交换分区

vm.swappiness=0

# 表示开启TCP连接中TIME-WAIT sockets的快速回收，默认为0，表示关闭

net.ipv4.tcp_tw_recycle = 1

# 表示系统同时保持TIME_WAIT套接字的最大数量，如果超过这个数字，TIME_WAIT套接字将立刻被清除并打印警告信息。默认为180000，改为5000

net.ipv4.tcp_max_tw_buckets = 10000

# 允许更多的PIDs (减少滚动翻转问题); may break some programs 32768

kernel.pid_max = 65535

# 表示用于向外连接的端口范围。缺省情况下很小：32768到61000，改为1024到65000

net.ipv4.ip_local_port_range = 1024 65000

# 记录的那些尚未收到客户端确认信息的连接请求的最大值。对于有128M内存的系统而言，缺省值是1024

net.ipv4.tcp_max_syn_backlog = 16384

# 时间戳可以避免序列号的卷绕。一个1Gbps的链路肯定会遇到以前用过的序列号。时间戳能够让内核接受这种“异常”的数据包。这里需要将其关掉

net.ipv4.tcp_timestamps = 0

# 为了打开对端的连接，内核需要发送一个SYN并附带一个回应前面一个SYN的ACK。也就是所谓三次握手中的第二次握手。这个设置决定了内核放弃连接之前发送SYN+ACK包的数量

net.ipv4.tcp_synack_retries = 2

# 在内核放弃建立连接之前发送SYN包的数量

net.ipv4.tcp_syn_retries = 2

# 如果套接字由本端要求关闭，这个参数决定了它保持在FIN-WAIT-2状态的时间。对端可以出错并永远不关闭连接，甚至意外当机。缺省值是60秒

# 但要记住的是，即使你的机器是一个轻载的WEB服务器，也有因为大量的死套接字而内存溢出的风险，FIN- WAIT-2的危险性比FIN-WAIT-1要小，因为它最多只能吃掉1.5K内存，但是它们的生存期长些

# 表示如果套接字由本端要求关闭，这个参数决定了它保持在FIN-WAIT-2状态的时间

net.ipv4.tcp_fin_timeout = 5

# 当keepalive起用的时候，TCP发送keepalive消息的频度。缺省是2小时

net.ipv4.tcp_keepalive_time = 1200

# ip_conntrack如果超过限制会出现丢包错误，默认为65535

# net.ipv4.ip_conntrack_max = 655360

# ip_conntrack回收速度

# net.ipv4.netfilter.ip_conntrack_tcp_timeout_established = 180

# 每个网络接口接收数据包的速率比内核处理这些包的速率快时，允许送到队列的数据包的最大数目

net.core.netdev_max_backlog =  262144

# web应用中listen函数的backlog默认会给我们内核参数的net.core.somaxconn限制到128，而Nginx内核参数定义的NGX_LISTEN_BACKLOG默认为511，所以有必要调整这个值

net.core.somaxconn = 262144

net.core.wmem_default = 8388608
net.core.rmem_default = 8388608
net.core.rmem_max = 16777216
net.core.wmem_max = 16777216

net.ipv4.tcp_mem = 94500000 915000000 927000000

# 系统中最多有多少个TCP套接字不被关联到任何一个用户文件句柄上。如果超过这个数字，孤儿连接将即刻被复位并打印出警告信息。这个限制仅仅是为了防止简单的DoS攻击

net.ipv4.tcp_max_orphans = 3276800

# 避免放大攻击

# net.ipv4.icmp_echo_ignore_broadcasts = 1

# 开启恶意icmp错误消息保护

# net.ipv4.icmp_ignore_bogus_error_responses = 1

# 开启并记录欺骗，源路由和重定向包

# net.ipv4.conf.all.log_martians = 1

# net.ipv4.conf.default.log_martians = 1

# 处理无源路由的包

# net.ipv4.conf.all.accept_source_route = 0

# net.ipv4.conf.default.accept_source_route = 0

# 开启反向路径过滤

# net.ipv4.conf.all.rp_filter = 1

# net.ipv4.conf.default.rp_filter = 1

# 确保无人能修改路由表

# net.ipv4.conf.all.accept_redirects = 0

# net.ipv4.conf.default.accept_redirects = 0

# net.ipv4.conf.all.secure_redirects = 0

# net.ipv4.conf.default.secure_redirects = 0

# 不充当路由器

# net.ipv4.ip_forward = 0

# net.ipv4.conf.all.send_redirects = 0

# net.ipv4.conf.default.send_redirects = 0

# Turn off the tcp_window_scaling

# #net.ipv4.tcp_window_scaling = 0

# # Turn off the tcp_sack

# #net.ipv4.tcp_sack = 0

#

参考上面的经验配置，按需要取消注释。
</code></pre>
<h2 id="修改时钟源"><a class="header" href="#修改时钟源">修改时钟源</a></h2>
<pre><code class="language-bash">查看当前时钟源和修改时钟源：

# cat /sys/devices/system/clocksource/clocksource0/available_clocksource

# cat /sys/devices/system/clocksource/clocksource0/current_clocksource

# echo hpet &gt; /sys/devices/system/clocksource/clocksource0/current_clocksource

之前发现有一台服务器同样进程耗费的 cpu比其他服务器高很多，经过查证开发同学在那个进程里频繁取系统时间，同时那台机器 gettimeofday之类的系统调用耗时比其他服务器要久。因为改代码已经来不及了，还好发现原来几台服务器的时钟源不同，经过修改后，取时间的系统调用时间大大下降。
</code></pre>
<h2 id="强制扫描磁盘"><a class="header" href="#强制扫描磁盘">强制扫描磁盘</a></h2>
<pre><code class="language-bash">机房突然停电，UPS没弄好，机器发生重启，一般会自动扫描硬盘，但是如果不放心要扫描主硬盘的话，可以手动来：

touch /forcefsck
在根目录下面创建一个名为 forcefsdk 的文件即可，然后重新启动就会进入强制 fsck程序。
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../1.基础/1.1 目录结构.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../1.基础/1.2.1 修改系统参数.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../1.基础/1.1 目录结构.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../1.基础/1.2.1 修改系统参数.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_line_numbers = true;
        </script>
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../ace.js" type="text/javascript" charset="utf-8"></script>
        <script src="../editor.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mode-rust.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-dawn.js" type="text/javascript" charset="utf-8"></script>
        <script src="../theme-tomorrow_night.js" type="text/javascript" charset="utf-8"></script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
