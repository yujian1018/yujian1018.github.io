---
title: "3.1 crontab"
date: 2019-08-30T15:13:01+08:00
---

## crontab

每次编辑完某个用户的cron设置后，cron自动在/var/spool/cron下生成一个与此用户同名的文件，  
此用户的cron信息都记录在这个文件中，这个文件是不可以直接编辑的，只可以用crontab -e 来编辑。  
cron启动后每过一份钟读一次这个文件，检查是否要执行里面的命令。因此此文件修改后不需要重新启动cron服务。

编辑/etc/crontab 文件配置cron

cron服务每分钟不仅要读一次/var/spool/cron内的所有文件，还需要读一次/etc/crontab,因此我们配置这个文件也能运用 cron服务做一些事情。用crontab配置是针对某个用户的，而编辑/etc/crontab是针对系统的任务。

cat /etc/crontab %系统任务调度的配置文件  
前四行是用来配置crond任务运行的环境变量，  
第一行SHELL变量指定了系统要使用哪个shell，这里是bash，  
第二行PATH变量指定了系统执行命令的路径，  
第三行MAILTO变量指定了crond的任务执行信息将通过电子邮件发送给root用户，如果MAILTO变量的值为空，则表示不发送任务执行信息给用户，  
第四行的HOME变量指定了在执行命令或者脚本时使用的主目录。第六至九行表示的含义将在下个小节详细讲述。这里不在多说。

用户任务调度：用户定期要执行的工作，比如用户数据备份、定时邮件提醒等。用户可以使用 crontab 工具来定制自己的计划任务。所有用户定义的crontab 文件都被保存在 /var/spool/cron目录中。其文件名与用户名一致。

```bash
01 ** ** root run-parts /etc/cron.hourly //每小时执行/etc/cron.hourly内的脚本  
02 4 ** * root run-parts /etc/cron.daily //每天执行/etc/cron.daily内的脚本
22 4* *0 root run-parts /etc/cron.weekly //每星期执行/etc/cron.weekly内的脚本
42 4 1* * root run-parts /etc/cron.monthly //每月去执行/etc/cron.monthly内的脚本
```

大家注意"run-parts"这个参数了，如果去掉这个参数的话，后面就可以写要运行的某个脚本名，而不是文件夹名了。

crontab文件的含义：  
用户所建立的crontab文件中，每一行都代表一项任务，每行的每个字段代表一项设置，它的格式共分为六个字段，前五段是时间设定段，第六段是要执行的命令段，格式如下：  
minute   hour   day   month   week   command  
其中：  
minute： 表示分钟，可以是从0到59之间的任何整数。  
hour：表示小时，可以是从0到23之间的任何整数。  
day：表示日期，可以是从1到31之间的任何整数。  
month：表示月份，可以是从1到12之间的任何整数。  
week：表示星期几，可以是从0到7之间的任何整数，这里的0或7代表星期日。  
command：要执行的命令，可以是系统命令，也可以是自己编写的脚本文件。  

在以上各个字段中，还可以使用以下特殊字符：  
星号（*）：代表所有可能的值，例如month字段如果是星号，则表示在满足其它字段的制约条件后每月都执行该命令操作。  
逗号（,）：可以用逗号隔开的值指定一个列表范围，例如，“1,2,5,7,8,9”  
中杠（-）：可以用整数之间的中杠表示一个整数范围，例如“2-6”表示“2,3,4,5,6”  
正斜线（/）：可以用正斜线指定时间的间隔频率，例如“0-23/2”表示每两小时执行一次。同时正斜线可以和星号一起使用，例如*/10，如果用在minute字段，表示每十分钟执行一次。  

## Crontab命令详解

```bash
crontab -u # 设定某个用户的cron服务，一般root用户在执行这个命令的时候需要此参数
crontab -l # 列出某个用户cron服务的详细内容
crontab -r # 删除某个用户的cron服务
crontab -e # 编辑某个用户的cron服务


比如说root查看自己的cron设置：crontab -u root -l
再例如，root想删除fred的cron设置：crontab -u fred -r
在编辑cron服务时，编辑的内容有一些格式和约定，输入：crontab -u root -e

# 每天早上6点
0 6 ***echo "Good morning." >> /tmp/test.txt # 注意单纯echo，从屏幕上看不到任何输出，因为cron把任何输出都email到root的信箱了。
# 每两个小时
0 */2** *echo "Have a break now." >> /tmp/test.txt
# 晚上11点到早上8点之间每两个小时，早上八点
0 23-7/2，8* **echo "Have a good dream：）" >> /tmp/test.txt
# 每天4:30 
30 4** *sh /root/backup.sh >> /dev/null 2>&1
# 每晚的21:30 
30 21* **/usr/local/etc/rc.d/lighttpd restart
# 每月1、10、22日的4 : 45 
45 4 1,10,22** /usr/local/etc/rc.d/lighttpd restart
# 在每天18 : 00至23 : 00之间每隔30分钟 
0,30 18-23 ***/usr/local/etc/rc.d/lighttpd restart
# 每星期六的11 : 00 pm 
0 23 * * 6 /usr/local/etc/rc.d/lighttpd restart
# 每一小时 
* */1*** /usr/local/etc/rc.d/lighttpd restart
# 晚上11点到早上7点之间，每隔一小时 
*23-7/1* ** /usr/local/etc/rc.d/lighttpd restart
# 每月的4号与每周一到周三的11点 
0 11 4 * mon-wed /usr/local/etc/rc.d/lighttpd restart
# 一月一号的4点 
0 4 1 jan * /usr/local/etc/rc.d/lighttpd restart

# 忽略日志输出

0 */3* ** /usr/local/apache2/apachectl restart >/dev/null 2>&1
# “/dev/null 2>&1”表示先将标准输出重定向到/dev/null，然后将标准错误重定向到标准输出，由于标准输出已经重定向到了/dev/null，因此标准错误也会重定向到/dev/null，这样日志输出问题就解决了。
```
