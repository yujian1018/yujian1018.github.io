---
title: "4.2.2 关键字"
date: 2019-08-30T10:56:29+08:00
---

## WITH

```sql

-- WITH
WITH ali AS (SELECT * FROM rpt_kh_amount_conf)
SELECT ali.val FROM ali


```

## NOT EXISTS

```sql
SELECT
  *
FROM
  `account` a1
WHERE a1.deleted = 0
  AND a1.status = 1
  AND a1.created_time >= '2021-08-16 14:10:31' AND NOT EXISTS
  (SELECT
    1
  FROM
    account a2
  WHERE a2.uid = a1.uid
    AND a2.deleted = 0
    AND a2.created_time < '2021-08-16 14:10:31')
```

## JSON

```sql
SELECT
    JSON_EXTRACT(CHARGE_DATA, "$[0].amount") as '取值',
    json_valid("$[0].amount") as 'path 类型',
    JSON_SEARCH(CHARGE_DATA, 'one', 'FRET'), 'chargeTypeCd', 'amount') as 'json search',
    json_valid(select 'json search') as 'json search path 类型',
    
    JSON_CONTAINS_PATH(CHARGE_DATA, 'one',"$[0].amount") as '是否包含',

    JSON_VALID(json_UNquote(REPLACE(JSON_SEARCH(CHARGE_DATA, 'one', 'FRET'), 'chargeTypeCd', 'amount'))) as a,
    
    JSON_EXTRACT(CHARGE_DATA, json_UNquote(REPLACE(JSON_SEARCH(CHARGE_DATA, 'one', 'FRET'), 'chargeTypeCd', 'amount'))) as '基础运费'

```

## 不常用命令

```sql
#表
SHOW TABLES;#获取表
SHOW COLUMNS FROM `file`; #获取列基础信息
DESCRIBE `file`;#获取列
SHOW FULL COLUMNS FROM `file`;#获取列所有信息


#编码
SELECT * FROM information_schema.SCHEMATA; #库的编码
SELECT * FROM information_schema.tables WHERE table_schema = 'party_2';#表的信息
SELECT * FROM information_schema.columns WHERE TABLE_SCHEMA='party_2'; #列的信息


#配置
SHOW STATUS;#获取状态配置信息
SHOW VARIABLES LIKE 'default_%'
SHOW VARIABLES LIKE 'log_%'; 


#日志
SHOW MASTER LOGS; #获取bin日志
SHOW MASTER STATUS;#日志状态
SHOW BINLOG EVENTS [IN 'log_name'] [FROM pos] [LIMIT [OFFSET,] ROW_COUNT];
SHOW BINLOG EVENTS IN 'mysql-bin.000001' LIMIT 0, 1000;#日志文件内容
FLUSH LOGS;#自此刻开始产生一个新编号的binlog日志文件
PURGE MASTER LOGS TO 'MySQL-bin.010'; #清除MySQL-bin.010日志
PURGE MASTER LOGS BEFORE '2008-06-22 13:00:00'; #清除2008-06-22 13:00:00前binlog日志
PURGE MASTER LOGS BEFORE DATE_SUB( NOW( ), INTERVAL 3 DAY); #清除3天前binlog日志BEFORE，变量的date自变量可以为'YYYY-MM-DD hh:mm:ss'格式。
RESET MASTER;#清空日志文件
mysqlbinlog /usr/LOCAL/mysql/DATA/mysql-bin.000001 #查看日志
mysqlbinlog mysql-bin.0000xx | mysql -u用户名 -p密码 数据库名 #还原数据
常用选项：
          --start-POSITION=953                   起始pos点
          --stop-POSITION=1437                   结束pos点
          --start-DATETIME="2013-11-29 13:18:54" 起始时间点
          --stop-DATETIME="2013-11-29 13:21:53"  结束时间点
          --database=zyyshop                     指定只恢复zyyshop数据库(一台主机上往往有多个数据库，只限本地log日志)
          

#主从

```
