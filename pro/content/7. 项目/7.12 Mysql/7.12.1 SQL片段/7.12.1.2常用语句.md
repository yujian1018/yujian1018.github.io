---
title: "常用语句"
date: 2022-06-09T17:56:29+08:00
weight: 07120102
pre: "<b>7.12.1.2 </b>"
---

```sql
-- 1.SELECT
order by 字段 asc或desc（即升级或降序）
SELECT * FROM attr -- 选择整张表的数据
SELECT uid FROM `attr` WHERE uid >= 163 LIMIT 5, 1; -- 从attr表选择uid字段，并且uid>163, LIMIT从第几行还是选择多少行
SELECT uid FROM `attr` WHERE uid >= 163 LIMIT 0, 1, -- 选取从0开始，选取一行数据
SELECT* FROM Table WHERE 字段 LIKE '%702%';
["SELECT NAME FROM yj_dynamic1.attr where name='", <<229,188,160,230,181,169,232,141,161>>, "'"]
CALL select_vip(id)
SELECT DISTINCT 列名称 FROM 表名称  去重
FIND_IN_SET( Str, StrList ) -> 返回Str在StrList中的第几位，没有返回0
1.1去重 DISTINCT  SELECT DISTINCT uid FROM task
1.2多条件查找
SELECT COUNT(uid) FROM `rmb_info` WHERE TIME >=1383632065 AND TIME <1383632067 AND 0=(SELECT COUNT(*) FROM `rmb_info` WHERE uid=uid AND TIME <1383632065);
 select 学号,班级,姓名,学科,成绩
 from 学生
 where 学号 in
 (
  select top 10 学号
  from 学生
  where 学科='语文'
  order by 成绩 desc
 )and 学号 not in
 (
  select top 10 学号
  from 学生
  where 学科='数学'
  order by 成绩 asc
 )
1.2.多表查询.
       SELECT a.uid FROM `aa` AS a, `attr` AS b WHERE b.lv >= 5 AND b.uid > 162 AND b.uid = a.`roleId` GROUP BY a.uid;
1.2 多库查询
 SELECT a.uid FROM `server1`.`attr` AS a, `server2`.`attr` AS b
   WHERE b.lv >= 5 AND b.uid > 162 AND b.uid = a.`roleId`
   GROUP BY a.uid
 UNION SELECT a.uid FROM `hyw`.`aa` AS a, `hyw`.`attr` AS b
   WHERE b.lv >= 5 AND b.uid > 162 AND b.uid = a.`roleId`
   GROUP BY a.uid
1.3 SELECT uid,SUM(IF(num>0, num, 0)) AS a, SUM(IF(num<0, num, 0)) AS b FROM rmb_cost GROUP BY uid HAVING a < -b

select `name` from item_prop where `name` in (select `name` from item_prop group by `name` having count(`name`) > 1);

-- 2.INSERT,设置主键自增
INSERT INTO 表名称 VALUES (值1, 值2,....)
INSERT INTO table_name (列1, 列2,...) VALUES (值1, 值2,....)
INSERT INTO yj_dynamic.activity_task(uid,tableId,state,num,completeNum) SELECT 2,tableId,state,num,completeNum FROM yj_dynamic1.activity_task WHERE uid=1

replace into 跟 insert 功能类似，不同点在于：replace into 首先尝试插入数据到表中，

/*
1. 如果发现表中已经有此行数据（根据主键或者唯一索引判断）则先删除此行数据，然后插入新的数据。
2. 否则，直接插入新数据。
要注意的是：插入数据的表必须有主键或者是唯一索引！否则的话，replace into 会直接插入数据，这将导致表中出现重复的数据。
*/
INSERT INTO `day_online_time`(`date`,`uid`,`platformId`,`time`,logincount) VALUES (1399564800,163,1,12369,logincount+1) ON DUPLICATE KEY UPDATE
TIME=13000, logincount=logincount+1 ;
ON DUPLICATE KEY UPDATE  MySQL 当记录不存在时插入，当记录存在时更新

-- 3.UPDATE
UPDATE 表名称 SET 列名称 = 新值 WHERE 列名称 = 某值
UPDATE fun_open SET funList=CONCAT(funList, '11000')
WHERE uid IN (SELECT DISTINCT uid FROM task WHERE tableId=102100 AND state=3 AND 0=FIND_IN_SET('11000',funList))
UPDATE fun_open SET funList = REPLACE(funList, '10400', '') WHERE uid IN (SELECT uid FROM attr WHERE lv<28)
Update A,B Set B.Name=A.Name, B.age='12' Where A.Id=B.Id;
Update A Inner Join B On A.Id=B.Id Set B.Name=A.Name;

-- 4.DELETE
DELETE FROM 表名称 WHERE 列名称 = 值
根据某个字段去重（推荐使用临时表,不重复的数据导入到一张表）
delete from 表 where 主键ID not in(select max(主键ID) from 表 group by 需要去重的字段 having count(需要去重的字段)>=1）


关键字 例 
 Group by 1.SELECT  
   DATE_FORMAT(FROM_UNIXTIME(`time`), '%Y%m%d') dayTime,
   SUM(win) AS win_count
 FROM
   game_info 
 WHERE `time` >= 1460217600 
   AND `time` < 1462204800 
 GROUP BY dayTime ;
In select count(*) from user where stats_time='2012-11-25' and 
 id in (select id from user where stats_time='2012-11-24' and type=1)
datediff select A.user,A.stats_time from user A, user B where A.userid = B.userid and B.type=1 and datediff(A.stats_time, B.stats_time)=1 
EXPLAIN  
CONCAT UPDATE ai SET icon = CONCAT('http://dz.game2us.com/head/', icon) 
REPLACE UPDATE ai SET icon = REPLACE(icon, '/head/../head', '/head') 
最大連接數 SHOW VARIABLES LIKE 'max_connections'; 
模糊查询 SHOW VARIABLES LIKE '%connections'; 
 SHOW STATUS; 
设置最大连接数 SET GLOBAL max_connections=1024; 
获取所有建立的连接 SHOW FULL PROCESSLIST 
 utf8mb4 移动端的表情占用4字节。需要设置成utf8的扩展字符 
 COALESCE 
  

```
