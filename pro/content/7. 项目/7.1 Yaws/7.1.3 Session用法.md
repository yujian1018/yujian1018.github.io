设置session时，需要运行
1.

Url = "/",
        [{"action", Action}|Data] = yaws_api:parse_query( A ),
        case Action of
            "reg" ->
                [ {"userlogin", UserName},
                  {"password", _Pwd},
                  {"passwordtoo", Pwd},
                  {"Email", Email},
{"val",_Val} ] = yaws_api:parse_post( A ),
                try myuser_mod_manager:reg_user( UserName, erlang:md5( Pwd ), Email ) of
                    Name ->
                        Cookie = yaws_api:new_cookie_session(Name),
                        [ yaws_api:redirect(Url), yaws_api:setcookie("haowenjiao",Cookie) ]
                catch
                    _:_Why ->
                        mnesiaDBA_pub_function:log( _Why, "../doc/logs/myuser.access" ),
                        {redirect, "/userLogin/userLogin.yaws"}
                end;
            "login" ->
                [ {"userlogin", UserName}, {"password", Pwd} ] = yaws_api:parse_post( A ),
                case myuser_mod_manager:login_user( UserName, erlang:md5( Pwd ) ) of
                    true ->
                        {redirect, "/"};
                    false ->
                        {redirect, "/userLogin/userLogin.yaws?name="++UserName++"&msg=账户名或密码错误"}
                end
        end.
2.

<erl>
out( A ) ->
Action =
case transfar_ctrl_cookie:check_cookie( A, "transfarHaowenjiao" ) of
{error, Other} ->
case transfar_ctrl_cookie:weixinOpenId( A ) of
{ok, SetCookie, OpenId} -> {ok, OpenId, SetCookie};
{error, "no code"} -> {error, "no code"};
{url, Url} -> {url, Url}
end;
{ok, OpenId, SetCookie1} ->
{ok, OpenId, SetCookie1}
end,
case Action of
{url, WeixinUrl} -> [{redirect, WeixinUrl}, {bindings, [{"openId", ""}]}];
{ok, WexinOpenId, Cookie} -> [{bindings, [{"openId", WexinOpenId}]}, yaws_api:setcookie("transfarHaowenjiao", Cookie), {ssi, "inc/meta.inc", "", ""}];
{error, "no code"} -> [{bindings, [{"openId", ""}]}, {html, "<script type=\"text/javascript\">window.location='error.yaws?action=OAuthError'</script>"}]
end.
</erl>
![pic](/images/screenshot_1527428601812.png)
