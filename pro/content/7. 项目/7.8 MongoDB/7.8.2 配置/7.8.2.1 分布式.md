---
title: "7.8.2.1 分布式"
date: 2019-08-30T10:56:29+08:00
weight: 07080201
---
分片，根据分片数据库做该分片的集群
mongo分布式：Replica Set / Sharding

参考档案：
<http://blog.csdn.net/luonanqin/article/details/8497860>

《MongoDB权威指南》第九章

集群方式：

主节点（primary）

备份节点（secondary，无法读取和写入）

仲裁者节点（参与选举）

注意：

1.一个mongo节点在初始化时需要指定replSet，才能加入集群，本地节点无法加入集群

2.备份节点正常情况无法读写，强制读取可以设置conn.setSlaveOk()

3.*.conf文件的项目路径 ./priv/etc/

4.分片。针对每一个分片节点做集群

5.指定数据库路径需要自己新建该目录。

6.集群就是各自启动一个节点，然后配置谁是主节点，谁是备份节点

配置集群：

sudo mongod -config master.conf(启动主节点)

sudo mongod -config slaver.conf(启动备份节点)

sudo mongod -config arbiter.conf(启动仲裁者节点)

登陆到主节点：

sudo mongo 192.168.1.101:27017   #ip和port是某个节点的地址

>cfg={
  "_id":"ADCMS_HUIYU",
  "members":[
   {"_id":0,"host":'10.10.148.130:27017',priority:2},
   {"_id":1,"host":'10.10.148.131:27017',priority:1},
   {"_id":2,"host":'10.10.148.132:27017',arbiterOnly:true}]};  

>rs.initiate(cfg)#使配置生效  

cfg的详细信息参考config.conf

>rs.status()查看节点详细信息

客户端写入:
>db.runCommand({“getLastError”:1, “w”:”majority”, “wtimeout”:1000})
该命令返回写入操作成功的节点名称

w:强制 getLastError等待，直到写入操作执行完才返回

wtimeout:超时时间

节点状态

STARTUP 刚出于启动状态
STARTUP2 整个初始化同步过程
RECONVERING 成员运转正常，但是暂时不能处理读取请求
ARBITER 仲裁者处于该状态
DOWN 正常运行的成员不可达
UNKOWN 成员无法到达其他任何成员
REMOVE 移出集群
ROLLBACK 进行数据回滚
FATAL 不可挽回的错误
 
分片

注意：

1.一个config配置节点集群，维护有多少个分片节点或者集群

2.一个mongos，对外的接口节点

3.多个mongod节点或者集群，一个mongod对应一个分片

4.分片需要指定基于什么规则到某个分片上查询数据
